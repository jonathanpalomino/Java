/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * Consulta_General.java
 *
 * Created on 04/08/2012, 11:40:37 PM
 */
package registrador;

import java.awt.event.ItemEvent;
import java.sql.*;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JTable;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author JONATHAN
 */
public class Consulta_General extends javax.swing.JFrame {
    Connection enlace;
    Statement st = null;
    ResultSet resp = null;
    String url_consulta = "";
    public String[][] data = {};
    private static DefaultTableModel miModelo;
    /** Creates new form Consulta_General */
    public Consulta_General(Libreria obje) {
        enlace = obje.getEnlace();
        initComponents();
        CargarRazas();
        
        miModelo = new DefaultTableModel(data, new String[]{"Usuario", "Raza","Direccion","Especial","Galaxia"}){

            public boolean isCellEditable(int row, int column) {
                return false;
            }
        };
        Tabla.setModel(miModelo);
        jScrollPane1.setViewportView(Tabla);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        btnConsulta = new javax.swing.JButton();
        txtUser = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        txtDireccion = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        chk_especial = new javax.swing.JCheckBox();
        jScrollPane1 = new javax.swing.JScrollPane();
        Tabla = new javax.swing.JTable();
        ComboRaza = new javax.swing.JComboBox();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Consulta_general");

        btnConsulta.setText("Consultar");
        btnConsulta.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnConsultaActionPerformed(evt);
            }
        });

        jLabel2.setText("Raza");

        jLabel1.setText("Usuario");

        jLabel3.setText("Direccion");

        jLabel4.setText("Especiales");

        Tabla.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane1.setViewportView(Tabla);

        ComboRaza.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                ComboRazaItemStateChanged(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 452, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addContainerGap())
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel3)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtDireccion))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel1)
                                .addGap(17, 17, 17)
                                .addComponent(txtUser, javax.swing.GroupLayout.PREFERRED_SIZE, 81, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4)
                            .addComponent(jLabel2))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(chk_especial, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(51, 51, 51)
                                .addComponent(btnConsulta))
                            .addComponent(ComboRaza, javax.swing.GroupLayout.PREFERRED_SIZE, 105, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addContainerGap(50, Short.MAX_VALUE))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(19, 19, 19)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel1)
                            .addComponent(txtUser, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel2)
                            .addComponent(ComboRaza, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel3)
                            .addComponent(txtDireccion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel4)
                            .addComponent(chk_especial)))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(54, 54, 54)
                        .addComponent(btnConsulta)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 23, Short.MAX_VALUE)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 211, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

private void btnConsultaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnConsultaActionPerformed
Ejecucion();
}//GEN-LAST:event_btnConsultaActionPerformed

private void ComboRazaItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_ComboRazaItemStateChanged
        if (evt.getStateChange() == ItemEvent.SELECTED) //Solo evento de seleccion
        {
            try {
                Asignar_codi_raza(ComboRaza.getSelectedItem().toString());
            }
            catch (Exception e) {
            }

        }
}//GEN-LAST:event_ComboRazaItemStateChanged

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox ComboRaza;
    private javax.swing.JTable Tabla;
    private javax.swing.JButton btnConsulta;
    private javax.swing.JCheckBox chk_especial;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextField txtDireccion;
    private javax.swing.JTextField txtUser;
    // End of variables declaration//GEN-END:variables

    private void Asignar_codi_raza(String Valor) {
        
    }

    private void Ejecucion() {
        inicializaTabla();
        if (enlace != null) {
            try {
                url_consulta="select usuarios.nomb_usuarios,razas.nomb_raza,razas.codi_raza,"
                        +"direcciones.Numero_direccion,direcciones.mca_especial,direcciones.Galaxia "
                        +"from usuarios,razas,direcciones "
                        +"where usuarios.codi_raza = razas.codi_raza "
                        +"AND usuarios.nomb_usuarios = direcciones.nomb_usuarios ";
                 if (!txtUser.getText().isEmpty()){
                     url_consulta = url_consulta +"AND usuarios.nomb_usuarios = IFNULL('"+txtUser.getText()+"',usuarios.nomb_usuarios) ";
                 }       
                 if (!txtDireccion.getText().isEmpty()){
                     url_consulta = url_consulta+"AND direcciones.Numero_direccion = IFNULL('"+txtDireccion.getText()+"',direcciones.Numero_direccion) ";
                 }
                 if (chk_especial.isSelected()){
                     url_consulta = url_consulta +"AND direcciones.mca_especial = IFNULL('S',direcciones.mca_especial) ";
                 }
                 if (ComboRaza.getSelectedItem().toString()!="Cualquiera"){
                     url_consulta = url_consulta +"AND razas.nomb_raza = IFNULL('"+ComboRaza.getSelectedItem().toString()+"',razas.nomb_raza)";
                 }     
                        
                       
                
                st = enlace.createStatement();
                System.out.println(url_consulta);
                resp = st.executeQuery(url_consulta);
                while (resp.next()) {
                     //System.out.println(resp.getObject(1) + " " + resp.getObject(2));
                     Object[] datos = {resp.getObject(1), resp.getObject(2),resp.getObject(4),resp.getObject(5),resp.getObject(6)};
                     getMiModelo().addRow(datos);
            getMiModelo().addRow(datos);
                        }
            } catch (SQLException ex) {
                Logger.getLogger(Consulta_General.class.getName()).log(Level.SEVERE, null, ex);
            }
                        
        }
    }

    private void CargarRazas() {
        if (enlace != null) {
            try {
                url_consulta = "SELECT nomb_raza FROM Razas";
                st = enlace.createStatement();
                resp = st.executeQuery(url_consulta);
                while (resp.next()) {
                    ComboRaza.addItem(resp.getObject(1));
                }
                ComboRaza.addItem("Cualquiera");
            }
            catch (SQLException ex) {
                Logger.getLogger(Consulta.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }
    public DefaultTableModel getMiModelo() {
        return miModelo;
    }
        public  JTable getMiTabla() {
        return Tabla;
    }
        public  void inicializaTabla() {
        // obtiene numero de filas de la tabla
        int filas = getMiTabla().getRowCount();
        // remueve todas las filas de la tabla
        for (int fila = 0; fila < filas; fila++) {
            getMiModelo().removeRow(0);
        }
    }
}
